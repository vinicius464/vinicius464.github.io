<html>
    <head>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.min.js" type="text/javascript"></script>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    </head>
    <body>
      
            
        
        <h2>Teste mqtt</h2>
        <br>
        <br>
        <button class="btn btn-sm btn-outline-primary" id="Led_Azul" >Led Azul</button>
        
        <button class="btn btn-sm btn-outline-primary" id="Led_Vermelho" style="margin-left: 30px;">Led Vermelho</button>
   
        <script>
            mqtt = new Paho.MQTT.Client("broker.hivemq.com",8000,"clients");
                var options = {
                    timeout: 3,
                    onSuccess: this.onConnect,
                    onFailure: this.onFailure,
                };
                mqtt.connect(options);
                mqtt.onMessageArrived = this.onMessageArrived;
            //init
            var azul = 1;
            var vermelho = 1;
            flag = 0
            
            document.getElementById("Led_Azul").style.background = "red";
            document.getElementById("Led_Vermelho").style.background = "red";
            //Button
            document.addEventListener('DOMContentLoaded', function() {
            document.querySelector('#Led_Azul').addEventListener('click', () => load('azul'));
            document.querySelector('#Led_Vermelho').addEventListener('click', () => load('vermelho'));
            });

            function load(Led) 
            {
                if (Led=="azul")
                {   
                    if (azul%2==0)
                    {
                        message = new Paho.MQTT.Message("0");
                        message.destinationName = "33439048";
                        mqtt.send(message);
                        document.getElementById("Led_Azul").style.background = "red";
                    }
                    else
                    {
                        message = new Paho.MQTT.Message("1");
                        message.destinationName = "33439048";
                        mqtt.send(message);
                        document.getElementById("Led_Azul").style.background = "green";
                    }
                    azul = azul+1;
                }
                if (Led=="vermelho")
                {   
                    if (vermelho%2==0)
                    {
                        message = new Paho.MQTT.Message("0");
                        message.destinationName = "97061659";
                        mqtt.send(message);
                        document.getElementById("Led_Vermelho").style.background = "red";
                    }
                    else
                    {
                        message = new Paho.MQTT.Message("1");
                        message.destinationName = "97061659";
                        mqtt.send(message);
                        document.getElementById("Led_Vermelho").style.background = "green";
                    }
                    vermelho = vermelho+1;
                }
                
                
            }
            function onFailure()
            {
                console.log("failed");
            }
            function onConnect()
            {
                console.log("success");
                mqtt.subscribe("95155975");
                message = new Paho.MQTT.Message("0");
                message.destinationName = "84225844";
                mqtt.send(message);
                console.log("sent");
                
            }
            function onMessageArrived(msg)
            {
                var message;
                console.log("received");
                //console.log(msg.payloadString.length);

                if (msg.payloadString.length==1)
                {
                    message = "0"+msg.payloadString;
                }
                else
                {
                    message = msg.payloadString;
                }
                
                
                vermelho = vermelho+parseInt(message[1]);
                console.log(vermelho);
                azul = azul+parseInt(message[0]);
                console.log(azul);
                if (azul==1)
                {
                    document.getElementById("Led_Azul").style.background = "red";
                }
                else
                {
                    document.getElementById("Led_Azul").style.background = "green";
                }
                if (vermelho==1)
                {
                    document.getElementById("Led_Vermelho").style.background = "red";
                }
                else
                {
                    document.getElementById("Led_Vermelho").style.background = "green";
                }
            }
        </script>

    </body>
</html>
